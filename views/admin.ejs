<%- layout('base.ejs')%>
<script src="/libs/tinymce/tinymce.min.js"></script>
<script src="/libs/angular-ui-tinymce/src/tinymce.js"></script>
<script src="/javascripts/utils.js"></script>
<script src="/javascripts/admin.js"></script>
<script src="/javascripts/directives/news_element.js"></script>
<link rel="stylesheet" href="/stylesheets/index.css">
<link rel="stylesheet" href="/libs/fontawesome/css/font-awesome.min.css">

<div class="admin-page" ng-app="admin" ng-controller="Admin">
	<div class="promises" ng-if="successful_save" ng-class="{ success : successful_save }"><p>Новость успешно сохранена</p></div>
	<div class="button_panel">
		<button ng-click="page='create_page'; news = {};">create</button>
		<button ng-click="page='feed_page'">feed</button>
		<button ng-click="page='list_page'">list</button>
	</div>

	<div ng-show="page=='create_page'">
		<h1>СОЗДАНИЕ/РЕДАКТИРОВАНИЕ НОВОСТИ</h1>
			
		<div class="input">
			<p class="labels">Title</p>
			<input type="text" 
				   ng-model="news.title">
			<p class="labels">Description</p>
			<textarea ng-model="news.description"></textarea>
			<p class="labels">Image</p>
			<input type="text" 
				   ng-model="news.image">
			<p class="labels">Content</p>
			<textarea ui-tinymce="tinymce_options"
				   	  ng-model="news.content"></textarea>
			<div class="button-bottom-panel">
				<button ng-if="!news._id" 
						ng-click="postNews(news, true)">Сохранить
				</button>
				<button ng-if="news._id" 
						ng-click="postNews(news)">Изменить
				</button>
			</div>
		</div>
		<div class="output">
			<news ng-model="news" class="s11"></news>
			<news ng-model="news" class="s21"></news>
			<news ng-model="news" class="s22"></news>
		</div>
	</div>
	<div ng-if="page=='feed_page'" ng-init="loadForPage(true)">
		<h1>НОВОСТНОЙ ФИД</h1>
		
		<div class="feed">
			<div ng-repeat="block in feed_blocks"
				 class="block">
				<news ng-if="element._size" 
	 				  ng-class="{ s11 : element._size == 1, s21 : element._size == 2 , s22 : element._size == 4}" 
	 				  ng-repeat="element in block.feed_elements" 
	 				  ng-model="element">
					<div class="admin-elements">
						<div class="row1">
							<span class="look">Просмотр</span>
						</div>
						<div class="row2">
							<span class="update" ng-click="loadToFormForUpdate(element)">Редактировать</span>
							<span class="delete" ng-click="deleteNews(element._id, true)">Удалить</span>
						</div>

					</div>
					
				</news>
			</div>
		</div>
	</div>

	<div ng-if="page=='list_page'" ng-init="loadForPage()"> 
		<h1>СПИСОК ВСЕХ НОВОСТЕЙ</h1>
		<div ng-repeat="news in feeds" class="news-in-list">
			
			<div class="image-info" style="background-image: url({{ news.image }})"></div>
			<span class="info">
					<p>{{ news.title }}</p>
					<p>{{ news.description }}</p>

				<span class = "button-block">
					<button ng-click="deleteNews(news._id)">Удалить</button>
					<button ng-click="loadToFormForUpdate(news)">Редактировать</button>
					<button><a href="/post/{{ news._id }}">Перейти в новость</a></button>
				</span>
			</span>
		</div>
	</div>
</div>

<style>
	.input, .output {
		float:left;
	}
	.input {
		width: 50%;
		border-top: gold;
		-webkit-transition: all 1s;
		-moz-transition: all 1s;
		transition: all 1s;
	}
	.success {
		background-color: lightgreen;
	}
	.output {
		width: 50%;
		border-top: cyan;
	}
	.promises {
		width: 100%;
		height: 40px;
		line-height: 40px;
		text-align: center;
	}
	.button-bottom-panel {
		padding: 40px 0;
	}
	p.labels {
		margin: 10px 0 0;
	}
	.input input, .input button, .input select, .input textarea {
		width: 100%;
		height: 30px;
		line-height: 30px;
		font-size: 15px;
	}
	.input textarea {
		line-height: 20px;
	}
	.input textarea {
		height: 100px;
	}
	button.size-change {
		float: left;
		width: 33.33333%;
		outline: none;
		border: 0;
	}
	button.highlighted {
		background-color: #2980b9;
	}
	.news-in-list {
		clear: both;
		background-color: #ddd;
		border: 1px solid #bbb;
		width: 100%;
		overflow: hidden;
		margin-bottom: 10px;
	}
	.image-info, .info {
		float: left;
		width: 800px;
	}
	.image-info {
		background-size: cover;
		background-position: center center;
		height: 50px;
		width: 50px;
	}
</style>