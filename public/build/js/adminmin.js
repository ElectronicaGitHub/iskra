tk.controller("Admin",["$scope","$http",function(a,b){a.init=function(){location.search?"post_id"==location.search.split("=")[0].slice(1)&&(post={_id:location.search.split("=")[1]},a.loadToFormForUpdate(post)):a.page="list_page"},a.new_type="normal",a.search_linked={},a.news_sections={space:"Космос",physics:"Физика",tech:"Технологии"},a.news_type="normal",a.feed_blocks=[],a.tinymce_options={theme:"modern",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor"],toolbar1:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent",toolbar2:"print preview media | forecolor backcolor emoticons | link image",image_advtab:!0,height:"500px",style_formats:[{title:"Описание картинки",selector:"p",classes:"img_description"},{title:"Заголовок раздела",block:"h2"}]},a.loadForPage=function(b){a.setDefaultAndGet(b)},a.setDefaultAndGet=function(b){a.feed_blocks=[],a.feeds=[],a.getNews(b)},a.getNews=function(c){url="/news/",b.get(url).success(function(b){a.feeds=b,c&&(a.feed_blocks=UTILS.blocks_former(a.feeds,a.feed_blocks))}).error(function(a){})},a.getLinkedPosts=function(){data={search_query:a.search_linked.search_query,section:a.search_linked.section},url="/linked_news?"+jQuery.param(data),b.get(url).success(function(b){a.linked_news=b}).error(function(a){})},a.postNews=function(c,d){a.post_loading=!0,url=d?"/admin":"/admin/"+c._id,c.linked_news&&(c.linked_news=c.linked_news.map(function(a){return a._id})),b.post(url,c).success(function(b){a.post_loading=!1,b.save&&(a.successful_save=!0,setTimeout(function(){a.successful_save=!1,a.$apply()},1500),a.page="list_page")}).error(function(b){a.post_loading=!1})},a.loadToFormForUpdate=function(c){b.get("/news/"+c._id).success(function(c){a.page="create_page",a.news=c,b.get("/news/many?posts="+a.news.linked_news.join(",")).success(function(b){a.news.linked_news=b}).error(function(a){})}).error(function(a){})},a.deleteNews=function(c,d){url="/admin/"+c,b.delete(url).success(function(b){a.setDefaultAndGet(d)}).error(function(a){})},a.selectPostForLink=function(b){if(a.news.linked_news&&0!=a.news.linked_news.length){for(i in a.news.linked_news)if(a.news.linked_news[i]._id==b._id)return void a.news.linked_news.splice(i,1);a.news.linked_news.push(b)}else a.news.linked_news=[],a.news.linked_news.push(b)}}]);